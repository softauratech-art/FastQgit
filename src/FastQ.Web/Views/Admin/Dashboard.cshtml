@model FastQ.Web.Models.AdminDashboardViewModel
@{
    ViewBag.Title = "Admin";
}

@section Head {
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
    <style>
        .wrap { padding: 15px; }
        h1 { font-size: 28px; }
        h4, modal-title { font-size: 18px; font-weight: bold; }

        .body-content {
            margin-top: 15px;
            padding-left: 15px;
            padding-right: 15px;
        }

        input,
        select,
        textarea {
            max-width: 280px;
        }

        @@media screen and (min-width: 768px) {
            .body-content { padding: 0; }
        }

        .sidebar-nav {
            position: sticky;
            top: 56px;
            height: calc(100vh - 56px);
            overflow-y: auto;
        }

        .hiddenRow { padding: 0 !important; }
        .hiddenRow button { width: 80px; margin-left: 10px; }

        .accordion-toggle { cursor: pointer; }
        .accordion-body { padding: 1rem; }
    </style>
}

<div class="container-fluid">
    <div class="row">
        <div class="col-lg-2 col-md-3 sidebar-nav bg-light p-3 d-none d-md-block">
            <div class="d-flex flex-column flex-shrink-0">
                <ul class="nav nav-pills flex-column mb-auto">
                    <li class="nav-item"><a href="/Admin/Dashboard" class="nav-link active">Dashboard</a></li>
                    <li><a href="/Provider/Today" class="nav-link link-dark">Calendar</a></li>
                    <li><a href="/Reporting/Overview" class="nav-link link-dark">Reports</a></li>
                    <li><a href="/Admin/Dashboard" class="nav-link link-dark">Settings</a></li>
                </ul>
            </div>
        </div>

        <main class="col-lg-10 col-md-9 ms-sm-auto px-md-4 mt-4">
            <div class="container body-content">
                <h2 id="title">Today's Schedule @if (!string.IsNullOrEmpty(Model.LocationName)) { <span class="text-muted">(@Model.LocationName)</span> }</h2>

                <div class="modal fade" id="meetingModal" tabindex="-1" role="dialog" aria-labelledby="meetingModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="meetingModalLabel">Meeting Details</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p>Meeting Id: <span id="mid"></span></p>
                                <p>
                                    Meeting Date: <span id="mDate"></span><br />
                                    Meeting Time: <span id="mStart"></span><br />
                                    Title: <span id="mTitle"></span><br />
                                </p>
                                <p>Customer Info:<br /><span id="mCustomer"></span></p>
                                <div class="row">
                                    <div class="col-sm-2">Join URL:</div>
                                    <div class="col-sm-10"><input id="mURL" class="col-md-10" type="text" value="" /></div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="savemeeting();">Save Changes</button>
                            </div>
                        </div>
                    </div>
                </div>

                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Start</th>
                            <th>Queue</th>
                            <th>Type of Service</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Contact</th>
                            <th class="text-center">Expand</th>
                        </tr>
                    </thead>
                    <tbody>
@{
    var rowIndex = 0;
}
@foreach (var row in Model.TodayAppointments)
{
    var collapseId = "collapseRow" + rowIndex;
    rowIndex++;
                        <tr data-bs-toggle="collapse" data-bs-target="#@collapseId" aria-expanded="false" aria-controls="@collapseId" class="accordion-toggle" data-id="@row.AppointmentId">
                            <td>@row.StartTimeText</td>
                            <td>@row.QueueName</td>
                            <td>@row.ServiceType</td>
                            <td>@row.CustomerName</td>
                            <td>@row.Phone</td>
                            <td>@row.StatusText</td>
                            <td>@row.ContactMethod</td>
                            <td class="text-center"><i class="bi bi-chevron-down"></i></td>
                        </tr>
                        <tr>
                            <td colspan="7" class="hiddenRow">
                                <div class="accordion-body collapse" id="@collapseId">
                                    <button class="btn btn-primary btn-sm">Check-In</button>
                                    <button class="btn btn-success btn-sm">Start</button>
                                    <button class="btn btn-warning btn-sm">Transfer</button>
                                    <button class="btn btn-info btn-sm js-meeting-info"
                                            data-id="@row.AppointmentId"
                                            data-date="@row.StartDateText"
                                            data-start="@row.StartTimeText"
                                            data-title="@row.ServiceType"
                                            data-customer="@row.CustomerName"
                                            data-phone="@row.Phone">Info</button>
                                    <button class="btn btn-danger btn-sm">Remove</button>
                                </div>
                            </td>
                        </tr>
}
@if (Model.TodayAppointments.Count == 0)
{
                        <tr>
                            <td colspan="8" class="text-muted">No appointments today.</td>
                        </tr>
}
                    </tbody>
                </table>

                <button id="btnAdd1" class="btn btn-outline-primary">Add Customer to Queue</button>
                <div class="row" style="padding-top:50px"><h4><a href="#">&lt;&lt;</a> Upcoming Appointments <a href="#"> &gt;&gt;</a></h4></div>

                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Start</th>
                            <th>Queue</th>
                            <th>Type of Service</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Contact</th>
                            <th class="text-center">Expand</th>
                        </tr>
                    </thead>
                    <tbody>
@{
    var futureIndex = 1000;
}
@foreach (var row in Model.UpcomingAppointments)
{
    var collapseId = "collapseRow" + futureIndex;
    futureIndex++;
                        <tr data-bs-toggle="collapse" data-bs-target="#@collapseId" aria-expanded="false" aria-controls="@collapseId" class="accordion-toggle" data-id="@row.AppointmentId">
                            <td>@row.StartTimeText</td>
                            <td>@row.QueueName</td>
                            <td>@row.ServiceType</td>
                            <td>@row.CustomerName</td>
                            <td>@row.Phone</td>
                            <td>@row.StatusText</td>
                            <td>@row.ContactMethod</td>
                            <td class="text-center"><i class="bi bi-chevron-down"></i></td>
                        </tr>
                        <tr>
                            <td colspan="7" class="hiddenRow">
                                <div class="accordion-body collapse" id="@collapseId">
                                    <button class="btn btn-primary btn-sm">Check-In</button>
                                    <button class="btn btn-success btn-sm">Start</button>
                                    <button class="btn btn-warning btn-sm">Transfer</button>
                                    <button class="btn btn-info btn-sm js-meeting-info"
                                            data-id="@row.AppointmentId"
                                            data-date="@row.StartDateText"
                                            data-start="@row.StartTimeText"
                                            data-title="@row.ServiceType"
                                            data-customer="@row.CustomerName"
                                            data-phone="@row.Phone">Info</button>
                                    <button class="btn btn-danger btn-sm">Remove</button>
                                </div>
                            </td>
                        </tr>
}
@if (Model.UpcomingAppointments.Count == 0)
{
                        <tr>
                            <td colspan="8" class="text-muted">No upcoming appointments.</td>
                        </tr>
}
                    </tbody>
                </table>

                <button id="btnAdd2" class="btn btn-outline-primary">Add New Appointment</button>
            </div>
        </main>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            $('.table .accordion-body').on('show.bs.collapse', function () {
                $('.table .accordion-body.show').not(this).collapse('hide');
            });

            $('.js-meeting-info').on('click', function (e) {
                e.stopPropagation();
                var btn = $(this);
                $('#mid').text(btn.data('id'));
                $('#mDate').text(btn.data('date'));
                $('#mStart').text(btn.data('start'));
                $('#mTitle').text(btn.data('title'));
                $('#mCustomer').text(btn.data('customer') + ' | ' + btn.data('phone'));
                var modal = new bootstrap.Modal(document.getElementById('meetingModal'));
                modal.show();
            });
        });

        function savemeeting() {
            var murl = $('#meetingModal #mURL').val();
            $('#meetingModal #mURL').val(murl);
            $('#meetingModal').modal('hide');
        }
    </script>
}
